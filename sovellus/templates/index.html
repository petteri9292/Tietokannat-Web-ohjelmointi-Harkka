{% extends "layout.html" %}

{% block title %}
    Home
{% endblock %}

{% block content %}
    {% if session.username %}
        <!-- Discussion Areas Section -->
        <h2>Discussion Areas</h2>
        {% if areas %}
            {% for area in areas %}
                {% if not area.is_hidden %}
                    <div class="area">
                        <h3>
                            <a href="/discussion/{{ area.id }}">{{ area.name }}</a>
                        </h3>
                        <p>{{ area.description }}</p>
                        <p>Number of Threads: {{ area.thread_count }}, Number of Messages: {{ area.message_count }}</p>
                        {% if area.last_message_date %}
                            <p>Last message: {{ area.last_message_date.strftime(" %H:%M %d.%m.%Y ") }}</p>
                        {% else %}
                            <p>No messages yet</p>
                        {% endif %}
                        <!-- Admin Delete Button for Areas -->
                        {% if session.role == "admin" %}
                            <a href="/delete_area/{{ area.id }}" onclick="return confirm('Are you sure you want to delete this message?');">Delete</a>
                        {% endif %}
                    </div>    
                {% endif %}
            {% endfor %}
        {% else %}
            <p>No discussion areas available.</p>
        {% endif %}

        <!-- Admin Option to Create New Area -->
        {% if session.role == "admin" %}
            <a href="/new_area">Create new area</a>
        {% endif %}

    {% else %}
        <!-- Login form for guests -->
        <form action="/login" method="POST">
            <p>Username:<br>
                <input type="text" name="username" required></p>
            <p>Password:<br>
                <input type="password" name="password" required></p>
            <input type="submit" value="Login">
        </form>

        <!-- Error Message -->
        {% if error %}
            <p style="color:red;">{{ error }}</p>
        {% endif %}

        <!-- Registration link -->
        <a href="/register">Register</a>
    {% endif %}
{% endblock %}
